<%= form_tag(checkout_state_path(state: :payment), :method => :patch) do %>
  <div class="p-wrapper--have_padding">
    <h2 class="title">
      カート小計(<%=@detail.item_count%>個の商品):
      <span>￥<%=@detail.item_total%></span>
    </h2>
    <div class="c-btn--submit u-margin__bottom_middle">
      <%= submit_tag "購入確認画面へ", class: 'c-btn--submit' %>
    </div>
    <h2 class="c-links__title">お届先住所</h2>
    <ul class="c-links">
      <% if @addresses.present? %>
        <% @addresses.each do |address| %>
          <li class="c-link--small_text--nolink">
            <div class="c-link__radio_div">
              <%= radio_button_tag "order[payment_attributes[address_id]]", address.id %>
            </div>
            <span>
              <%= address.city %> <%= address.address %>
            </span>
          </li>
        <% end %>
      <% end %>
      <a href="<%= new_account_address_path %>">
      <li class="c-link">
        新規住所登録
      </li>
    </ul>
    <h2 class="c-links__title">支払い方法</h2>
    <ul class="c-links u-margin__bottom_middle">
      <li class="c-link--nolink">
        <div class="c-link__radio_div">
          <%= radio_button_tag "payment_method_id", 1, nil, :onclick=> "payment_method_change(this.value)" %>
        </div>      
        <p>
         クレジット
        </p>
      </li>
      <li class="c-link--nolink">
        <div class="c-link__radio_div">
          <%= radio_button_tag "payment_method_id", 2, nil, :onclick=> "payment_method_change(this.value)" %>
        </div>      
        <p>
        後払い決済
        </p>
      </li>
    </ul>
    <ul class="c-links js-credit">
      <% @gmo_cards.each do |gmo_card| %>
        <li class="c-link--small_text--nolink">
          <div class="c-link__radio_div">
            <%= radio_button_tag "order[payment_attributes[gmo_card_seq_temporary]]", gmo_card[:CardSeq] %>
            <%= gmo_card[:CardName] %> 番号：<%= gmo_card[:CardNo] %> <br />
          <% end %>
          <%= link_to "新規クレジットカード登録", new_profile_credit_card_path %>
        </span>
      </li>
    </ul>
    <h2 class="c-links__title">ポイント使用</h2>
    <ul class="p-payment_method_selections">
      <li class="p-payment_method_selection">
        <div class="p-payment_method_selection__radio">
          <%= radio_button_tag "order[use_all_point]", true %>
        </div>
        <p class="p-payment_method_selection__title">全て使用</p>
        <p class="p-payment_method_selection__price"><%= @wellness_mileage %>Pt</p>
      </li>
      <li class="p-payment_method_selection">
        <div class="p-payment_method_selection__radio">
          <%= radio_button_tag "order[use_all_point]", false %>
        </div>
        <p class="p-payment_method_selection__title">一部を使用</p>
        <div class="p-payment_method__detail is-active">
          <p>ポイント: </p>
          <%= number_field_tag "order[used_point]", 0, min: 0, max: @wellness_mileage, class: 'p-payment_method__amount' %>
          <p class="u-margin_short">Pt</p>
        </div>
      </li>
    </ul>
    <h2 class="c-links__title">購入詳細</h2>
    <div class="c-payment_method_section">
      購入形式: <%= t('order_type.single_order') %>
    </div>
    <% @items.each do |item| %>
      <div class="c-product_list">
        <div class="c-product_list__image">
          <%= image_tag item.images.first.image.url %>
        </div>
        <div class="c-product__list_detail_wrapper">
          <div class="c-product_list__title">
            <%= @products.where(id: item.product_id).name %>
          </div>
          <div class="c-product_list__price">
            ￥<%= item.prices.first.amount %>(<%= @single_line_items.where(variant_id: item.id).pluck(:quantity).first %>個)
          </div>
        </div>
      </div>
    <% end %>
    <div class="c-btn--submit">
      <%= submit_tag "購入確認画面へ", class: 'c-btn--submit' %>
    </div>
  </div>
<%# TODO subscription %>

<% end %>
